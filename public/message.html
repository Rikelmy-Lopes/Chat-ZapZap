<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
    
    <title>Document</title>
</head>
<body>
    <div id="messages">
    <span>Messages: </span>

    </div>
    <input placeholder="mensagem" id="message" value="" type="text">
    <button id="button">Enviar</button>

    <script type="text/javascript">
        const socket = io('http://192.168.0.189:4000/')

        socket.on('roomId', (roomId) => {
          localStorage.setItem('roomId', roomId)
        })

        socket.on('message-receive-buck', (messages) => {
          const divMessage = document.getElementById('messages')
          divMessage.innerHTML = ''
          messages.forEach((message) => divMessage.innerHTML += `<p> ${ message } </p>`)
        })

    function separarNumeros(str) {
      const numeros = str.match(/\d+/g); // encontra todos os números na string
      if (numeros && numeros.length === 2) { // se houver exatamente 2 números
        const obj = {
        me: numeros[0], // o primeiro número é o 'me'
        chatWith: numeros[1] // o segundo número é o 'chatWith'
    };
      return obj;
  } else {
    throw new Error("A string não contém exatamente dois números.");
  }
}

        window.onload = () => {
          const { me, chatWith } = separarNumeros(window.location.pathname)
          socket.emit('chat-open', { phone1: me, phone2: chatWith })
        }


        document.getElementById('button').addEventListener('click', () => {
            const message = document.getElementById('message').value;
            const roomId = localStorage.getItem('roomId')
            socket.emit('message', { message, roomId })
            document.getElementById('message').value = ''
        })

        document.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            const message = document.getElementById('message').value;
            const roomId = localStorage.getItem('roomId')
            socket.emit('message', { message, roomId })
            document.getElementById('message').value = ''
          }

          return
        })

        socket.on('message-receive', (messages) => {
        const divMessage = document.getElementById('messages')
        divMessage.innerHTML = ''
        messages.forEach((message) => divMessage.innerHTML += `<p> ${ message } </p>`)
        // divMessage.innerHTML += `<p> ${ message } </p>`
        })
    </script>
</body>
</html>